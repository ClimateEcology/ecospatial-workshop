<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Heather Grab, Kevin Li" />

<meta name="date" content="2024-10-03" />

<title>EcoSpatial Workshop: Working with GIS data</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Beeshiny Workshop</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="EcoSpatial_Workshop_GIS.html">Use Beeshiny: GIS</a>
</li>
<li>
  <a href="EcoSpatial_Workshop_Weather.html">Use Beeshiny: Weather data</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">EcoSpatial Workshop: Working with GIS
data</h1>
<h4 class="author">Heather Grab, Kevin Li</h4>
<h4 class="date">2024-10-03</h4>

</div>


<div id="workshop-outline" class="section level1 unnumbered">
<h1 class="unnumbered">Workshop Outline</h1>
<p>This workshop is designed to introduce users to the new <a
href="https://beesuite.psu.edu/beeshiny/"><strong>beeshiny
app</strong></a>.</p>
<p>beeshiny can be used to query data commonly used when modeling the
environemental drivers of species’ or commmunity responses. beeshiny was
originally build as a companion to <a
href="https://beescape.psu.edu/">Beescape</a>.</p>
<p>beeshiny allows users to extract:</p>
<ul>
<li>climate data: monthly precipitation, min, and max temperature from
PRISM</li>
<li>crop land covers: from the NASS CropLand Data Layer</li>
<li>beescape indices: spring forage, summer forage, fall forage,
nesting, and pesticides</li>
</ul>
<div id="nomenclature" class="section level2" number="0.1">
<h2><span class="header-section-number">0.1</span> Nomenclature</h2>
<ul>
<li><strong>raster:</strong> A form of geographic data that represents
the landscape as a grid of cells. Grid values can be continuous values,
signifying things like elevation, temperature, or spectral information
(e.g. color) in a satellite image; or categorical values, signifying
thematic classes like land cover.</li>
<li><strong>vector:</strong> Another form of geographic data that
represents specific features on the landscape composed of discrete
geometric locations that consist of x and y values. These can be points,
lines, or polygons.</li>
<li><strong>Cropland Data Layer (CDL):</strong> A set of raster datasets
produced by the USDA Nationa Agricultural Statistics (NASS) Service and
Agricultural Research Service (ARS) that represents annual crop-specific
land cover produced from satellite imagery and ground reference
data.</li>
</ul>
</div>
<div id="data-details" class="section level2" number="0.2">
<h2><span class="header-section-number">0.2</span> Data Details</h2>
<ul>
<li><p>We will use data downloaded from the <a
href="https://beesuite.psu.edu/beeshiny/"><strong>beeshiny
app</strong></a>.</p></li>
<li><p>We will also use point data representing hypothetical sites in
Centre County, PA, which can be downloaded from this repository at
<code>/data/centre_co_pts.csv</code>.</p></li>
<li><p><em>Note that if you are unable to access the data on beeshiny,
backup data are available in the repository in</em>
<code>data/backups</code></p></li>
</ul>
</div>
<div id="load-packages" class="section level2" number="0.3">
<h2><span class="header-section-number">0.3</span> Load packages</h2>
<p>There are a number of packages in R that are helpful in working with
spatial data. For this workshop we will be using <code>sf</code> and
<code>terra</code>. For data wrangling and visualizations we will use
<code>dplyr</code>, <code>ggplot2</code> and <code>tidyterra</code>.</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>dplyr</code></td>
<td align="left">Package that provides a ‘grammar’ of data manipulation
in <code>R</code></td>
<td align="left"><a href="https://dplyr.tidyverse.org/"
class="uri">https://dplyr.tidyverse.org/</a></td>
</tr>
<tr class="even">
<td align="left"><code>ggplot2</code></td>
<td align="left">Package that provides a system for declaratively
creating graphics</td>
<td align="left"><a href="https://ggplot2.tidyverse.org/"
class="uri">https://ggplot2.tidyverse.org/</a></td>
</tr>
<tr class="odd">
<td align="left"><code>sf</code></td>
<td align="left">Package for manipulating 2-D geographic vector
data</td>
<td align="left"><a href="https://r-spatial.github.io/sf/"
class="uri">https://r-spatial.github.io/sf/</a></td>
</tr>
<tr class="even">
<td align="left"><code>terra</code></td>
<td align="left">Package for spatial data analysis</td>
<td align="left"><a href="https://rspatial.github.io/terra/"
class="uri">https://rspatial.github.io/terra/</a></td>
</tr>
<tr class="odd">
<td align="left"><code>tidyterra</code></td>
<td align="left">Package for integrating objects from <code>terra</code>
with the <code>dplyr</code> and <code>ggplot2</code> packages</td>
<td align="left"><a href="https://dieghernan.github.io/tidyterra/"
class="uri">https://dieghernan.github.io/tidyterra/</a></td>
</tr>
</tbody>
</table>
<p>Because some spatial functions have the same names as dplyr functions
it is helpful to load the spatial packages last. We can also use the
<code>::</code> to specify the package for function calls.</p>
<p>Unhash (remove the preceding <code>#</code>) and use install.packages
for any packages your may not already have installed</p>
<pre class="r"><code># install.packages(&quot;dplyr&quot;, dependencies = TRUE)
# install.packages(&quot;ggplot2&quot;, dependencies = TRUE)
# install.packages(&quot;sf&quot;, dependencies = TRUE)
# install.packages(&quot;terra&quot;, dependencies = TRUE)
# install.packages(&quot;tidyterra&quot;, dependencies = TRUE)

library(dplyr)
library(ggplot2)
library(sf)
library(terra)
library(tidyterra)</code></pre>
</div>
<div id="about-yourself-and-use-cases" class="section level2"
number="0.4">
<h2><span class="header-section-number">0.4</span> About yourself and
use cases</h2>
<p>If you’re interested in beeshiny, please help us make it better by <a
href="https://forms.office.com/r/w3xcsXzQpq"><strong>telling us a little
about yourself</strong></a> and <a
href="https://forms.office.com/r/2jMEiYha1a"><strong>your common use
cases</strong></a>!</p>
</div>
</div>
<div id="working-with-raster-data-in-r" class="section level1"
number="1">
<h1><span class="header-section-number">1</span> Working with raster
data in R</h1>
<div id="get-raster-data-from-beeshiny" class="section level2"
number="1.1">
<h2><span class="header-section-number">1.1</span> Get raster data from
beeshiny</h2>
<p>Use <a
href="https://beesuite.psu.edu/beeshiny/"><strong>beeshiny</strong></a>
to download the cropland data layer (CDL) raster for <strong>Centre
County, Pennsylvania</strong> for the year <strong>2021</strong>.</p>
</div>
<div id="read-in-raster-data" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Read in raster
data</h2>
<p>Downloaded data from beeshiny is packaged as a zipped file called
data.zip. Inside this file you should have a .tif file. The name
indicates the data type, in this case CDL, the year and the FIPS code
that corresponds to the county you selected.</p>
<p><strong>For the code below to work, you must move the .tif file into
the <em>/data</em> folder in your ecospatial-workshop
directory.</strong></p>
<p>The first thing we will do is use the <code>rast()</code> function to
read the .tif file into R as a <code>SpatRaster</code> object. NOTE: if
you aren’t able to download the raster from beeshiny, you can access a
pre-downloaded copy in the <em>data/backups/</em> folder.</p>
<pre class="r"><code>centre_cdl &lt;- rast(&quot;data/CDL_2021_FIPS_42027.tif&quot;)    # add &#39;backup/&#39; after data to use backup data

centre_cdl
#&gt; class       : SpatRaster 
#&gt; dimensions  : 2147, 3167, 1  (nrow, ncol, nlyr)
#&gt; resolution  : 30, 30  (x, y)
#&gt; extent      : 1467225, 1562235, 2105925, 2170335  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. : NAD83 / Conus Albers (EPSG:5070) 
#&gt; source      : CDL_2021_FIPS_42027.tif 
#&gt; name        : Class_Names 
#&gt; min value   :           1 
#&gt; max value   :         254</code></pre>
<p>An important attribute of spatial data are their Coordinate Reference
System or CRS. This information tells us what model of the earth (ex
WGS84 or NAD83) is being referenced as well as the units of the
coordinates such as decimal degrees.</p>
<p>Rasters downloaded from beeshiny inherit their CRS from the raster
they were originally extracted from.</p>
<p>Let’s view the CRS for your county cdl:</p>
<pre class="r"><code>crs(centre_cdl)
#&gt; [1] &quot;PROJCRS[\&quot;NAD83 / Conus Albers\&quot;,\n    BASEGEOGCRS[\&quot;NAD83\&quot;,\n        DATUM[\&quot;North American Datum 1983\&quot;,\n            ELLIPSOID[\&quot;GRS 1980\&quot;,6378137,298.257222101,\n                LENGTHUNIT[\&quot;metre\&quot;,1]]],\n        PRIMEM[\&quot;Greenwich\&quot;,0,\n            ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433]],\n        ID[\&quot;EPSG\&quot;,4269]],\n    CONVERSION[\&quot;Conus Albers\&quot;,\n        METHOD[\&quot;Albers Equal Area\&quot;,\n            ID[\&quot;EPSG\&quot;,9822]],\n        PARAMETER[\&quot;Latitude of false origin\&quot;,23,\n            ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433],\n            ID[\&quot;EPSG\&quot;,8821]],\n        PARAMETER[\&quot;Longitude of false origin\&quot;,-96,\n            ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433],\n            ID[\&quot;EPSG\&quot;,8822]],\n        PARAMETER[\&quot;Latitude of 1st standard parallel\&quot;,29.5,\n            ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433],\n            ID[\&quot;EPSG\&quot;,8823]],\n        PARAMETER[\&quot;Latitude of 2nd standard parallel\&quot;,45.5,\n            ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433],\n            ID[\&quot;EPSG\&quot;,8824]],\n        PARAMETER[\&quot;Easting at false origin\&quot;,0,\n            LENGTHUNIT[\&quot;metre\&quot;,1],\n            ID[\&quot;EPSG\&quot;,8826]],\n        PARAMETER[\&quot;Northing at false origin\&quot;,0,\n            LENGTHUNIT[\&quot;metre\&quot;,1],\n            ID[\&quot;EPSG\&quot;,8827]]],\n    CS[Cartesian,2],\n        AXIS[\&quot;easting (X)\&quot;,east,\n            ORDER[1],\n            LENGTHUNIT[\&quot;metre\&quot;,1]],\n        AXIS[\&quot;northing (Y)\&quot;,north,\n            ORDER[2],\n            LENGTHUNIT[\&quot;metre\&quot;,1]],\n    USAGE[\n        SCOPE[\&quot;Data analysis and small scale data presentation for contiguous lower 48 states.\&quot;],\n        AREA[\&quot;United States (USA) - CONUS onshore - Alabama; Arizona; Arkansas; California; Colorado; Connecticut; Delaware; Florida; Georgia; Idaho; Illinois; Indiana; Iowa; Kansas; Kentucky; Louisiana; Maine; Maryland; Massachusetts; Michigan; Minnesota; Mississippi; Missouri; Montana; Nebraska; Nevada; New Hampshire; New Jersey; New Mexico; New York; North Carolina; North Dakota; Ohio; Oklahoma; Oregon; Pennsylvania; Rhode Island; South Carolina; South Dakota; Tennessee; Texas; Utah; Vermont; Virginia; Washington; West Virginia; Wisconsin; Wyoming.\&quot;],\n        BBOX[24.41,-124.79,49.38,-66.91]],\n    ID[\&quot;EPSG\&quot;,5070]]&quot;</code></pre>
<p>We can see that our CDL raster is using the North American Datum of
1983 as its model for the shape of the earth. Our two-dimensional
projection model of earth’s 3d surface is Alber’s Equal Area and the
units of our coordinates are in meters.</p>
</div>
<div id="visualize-raster-data" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Visualize raster
data</h2>
<p>We can visualize our county CDl raster by using the base R
<code>plot</code> function:</p>
<pre class="r"><code>plot(centre_cdl)</code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/base-1.png" width="672" /></p>
<p>We’ll talk about other plotting options such as using the packages
<code>ggplot2</code> and <code>tidyterra</code> a little later.</p>
<div id="reclass-to-named-cdl-classes" class="section level3"
number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Reclass to named
CDL classes</h3>
<p>Right now we are viewing the raw numeric codes of the CDL. These
codes mean something: the crop land cover class. We can tell
<code>terra</code> what these codes mean so that it will show the land
cover class names rather than the raw values. The information for these
land cover values (along with their colors) are stored in the color
table in <em>data/cdl_colormap.csv</em>.</p>
<pre class="r"><code>cdl_colormap &lt;- read.csv(&quot;data/cdl_colormap.csv&quot;)   # read in the table

head(cdl_colormap)  # use `head()` to take a look at the first 5 rows of cdl_colormap
#&gt;   value red green blue alpha class_name
#&gt; 1     0   0     0    0   255 Background
#&gt; 2     1 255   211    0   255       Corn
#&gt; 3     2 255    38   38   255     Cotton
#&gt; 4     3   0   168  228   255       Rice
#&gt; 5     4 255   158   11   255    Sorghum
#&gt; 6     5  38   112    0   255   Soybeans</code></pre>
<p><strong>Question:</strong> Which column represents the raw CDL values
and which column represents their land cover class?</p>
<p>We set the levels of the raster to the land cover class names using
the relevant elements of <code>cdl_colormap</code>: ‘value’ (column 1)
and ‘class_name’ (column 6).</p>
<pre class="r"><code>levels(centre_cdl) &lt;- cdl_colormap[,c(1,6)]

plot(centre_cdl)  # plot, as above, but now R knows what the numeric values mean</code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/def_level-1.png" width="672" /></p>
<p>Then we can recolor the classes to match the traditional <a
href="https://www.nass.usda.gov/Research_and_Science/Cropland/docs/US_2023_CDL_legend.jpg">NASS
CDL style</a>.</p>
<p>This color information is stored in columns 2-5 of the
<code>cdl_colormap</code> table, representing red, green, blue, and
alpha (transparency) values. We use the function <code>coltab</code> to
supply the color map with this information in columns that are in this
specific order, plus the corresponding (raw) raster value as the first
column (they are already set up as the first 5 columns of
<code>cdl_colormap</code>)</p>
<pre class="r"><code>coltab(centre_cdl) &lt;- cdl_colormap[,1:5]

plot(centre_cdl)  # plot, as above, but now R knows what the numeric values mean and assigns colors</code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Let’s look at some customization options. To do this, we’ll be using
the <code>ggplot2</code> <code>tidyterra</code> packages.
<code>ggplot2</code> plots a little differently from base R. Data
elements are layered on top of a base plot using <code>+</code> signs
and functions that start with <code>geom_</code>. Here, we’re starting
with a blank base plot and adding the spatraster object using
<code>geom_spatraster()</code>.</p>
<pre class="r"><code>ggplot() +  # blank base plot
  geom_spatraster(data = centre_cdl, aes(fill = class_name))   # add the spatraster layer</code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/ggplot-1.png" width="672" /></p>
<p>The legend is now quite large but can be easily modified using
<code>ggplot2</code> <code>theme</code> functions.</p>
<pre class="r"><code>ggplot() +
  geom_spatraster(data = centre_cdl, aes(fill = class_name)) +
  theme(legend.title = element_text(size = 7), # make legend title smaller
        legend.text = element_text(size = 7), # make legend text smaller
        legend.key.size = unit(0.25, &#39;cm&#39;), #make legend color keys smaller
        legend.position=&quot;bottom&quot;) # move legend to the bottom of the plot</code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="reclass-crop-land-cover-to-spring-floral-resources"
class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Reclass crop land
cover to spring floral resources</h3>
<p>Up to know, our CDL raster values are still numeric values that
represent crop land cover class from the CDL. We can reclassify these
CDL values to the estimated floral resources of each land cover class,
based on <a
href="https://www.pnas.org/doi/abs/10.1073/pnas.1517685113">Koh et
al. (2015)</a>.</p>
<p>A reclassification table based on Koh et al. is in the
<code>data/</code> folder. The table rows connect each CDL value to its
corresponding class name and the values for several indices.</p>
<pre class="r"><code>reclass_table &lt;- read.csv(&quot;data/cdl_reclass_koh.csv&quot;)  # read in the reclassification table

head(reclass_table)     # take a look at the first 5 rows
#&gt;   value class_name nesting_ground_availability_index nesting_cavity_availability_index
#&gt; 1     0 Background                         0.0000000                        0.00000000
#&gt; 2     1       Corn                         0.1451854                        0.08947642
#&gt; 3     2     Cotton                         0.3355898                        0.22867787
#&gt; 4     3       Rice                         0.1513067                        0.13945144
#&gt; 5     4    Sorghum                         0.1451854                        0.08947642
#&gt; 6     5   Soybeans                         0.1993286                        0.11568643
#&gt;   nesting_stem_availability_index nesting_wood_availability_index
#&gt; 1                       0.0000000                       0.0000000
#&gt; 2                       0.1069437                       0.1026114
#&gt; 3                       0.2335293                       0.2774442
#&gt; 4                       0.1089976                       0.1024528
#&gt; 5                       0.1069437                       0.1026114
#&gt; 6                       0.1263174                       0.1470606
#&gt;   floral_resources_spring_index floral_resources_summer_index floral_resources_fall_index
#&gt; 1                    0.00000000                     0.0000000                   0.0000000
#&gt; 2                    0.09025383                     0.2747074                   0.1323095
#&gt; 3                    0.39644857                     0.3160415                   0.1655815
#&gt; 4                    0.11008896                     0.2821817                   0.1334781
#&gt; 5                    0.09025383                     0.2747074                   0.1323095
#&gt; 6                    0.24359554                     0.3971508                   0.1858675</code></pre>
<p>A reclassification table assigns the original values of a raster
(listed in the first column) to a new value (listed in the second
column). This is done using the <code>classify()</code> function.</p>
<p>We will select the columns corresponding to the CDL value and the
spring floral resources as our original and new values, respectively,
for our reclass table. We’ll reclassify the Centre County CDL and
generate a map of spring floral resources across the county.</p>
<pre class="r"><code>centre_floral_sp &lt;- classify(centre_cdl,
                    reclass_table[,c(&quot;value&quot;,
                                     &quot;floral_resources_spring_index&quot;)])

plot(centre_floral_sp)</code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/reclass%20to%20forage-1.png" width="672" /></p>
</div>
</div>
<div id="inspect-raster-values" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Inspect raster
values</h2>
<p>Using the <code>values()</code> function we can directly inspect the
spring floral values for Centre County. We will set the argument
<code>na.rm=TRUE</code> so that all the empty cells (outside of the
county) are not included. The result of <code>values()</code> shows
individual grid cell values. In this case we will only extract the first
20 grid cell values.</p>
<pre class="r"><code>values(centre_floral_sp, na.rm=TRUE)[1:20]   # just the first 20 cells
#&gt;  [1] 0.5848480 0.0000000 0.6965277 0.5848480 0.0000000 0.0000000 0.6965277 0.5848480 0.0000000
#&gt; [10] 0.0000000 0.6965277 0.6965277 0.6965277 0.0000000 0.0000000 0.0000000 0.6965277 0.6965277
#&gt; [19] 0.5848480 0.0000000</code></pre>
<p>We can also use some basic summary functions to view the distribution
of floral resource values for the county.</p>
<pre class="r"><code>summary(values(centre_floral_sp, na.rm=TRUE))    # make a summary with the quartiles and the mean
#&gt;    class_name    
#&gt;  Min.   :0.0000  
#&gt;  1st Qu.:0.4558  
#&gt;  Median :0.6965  
#&gt;  Mean   :0.5813  
#&gt;  3rd Qu.:0.6965  
#&gt;  Max.   :0.6993

hist(values(centre_floral_sp, na.rm=TRUE))       # make a basic histogram of values</code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/summarize_values-1.png" width="672" /></p>
</div>
<div id="write-out-raster-files" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Write out raster
files</h2>
<p>We can save our raster files as a .tif using
<code>writeRaster</code>. For the CDL raster we will save the data in
“INT1U” format which will also save the class names and color table.</p>
<pre class="r"><code>writeRaster(centre_cdl, &quot;data/centre_county_cdl_2021.tif&quot;, overwrite=TRUE, datatype=&quot;INT1U&quot;)

writeRaster(centre_floral_sp, &quot;data/centre_county_springfloral_2021.tif&quot;, overwrite=TRUE)</code></pre>
</div>
<div id="check-your-learning" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Check your
learning</h2>
<ol style="list-style-type: decimal">
<li><p>Use beeshiny to download the CDL raster for another county in the
continental US for any year you want.</p></li>
<li><p>Move the CDL raster for Centre County to the <em>/data</em>
folder in your ecospatial-workshop directory.</p></li>
<li><p>Read the raster into R as a terra <code>SpatRaster</code> using
<code>rast()</code>.</p></li>
<li><p>Assign the CDL value codes with land cover class names using
<code>levels()</code> and assign colors using
<code>cdl_colormap()</code>.</p></li>
</ol>
<pre class="r fold-hide"><code>
# county_cdl &lt;- rast(&quot;data/CDL_2021_FIPS_42027.tif&quot;) 

# levels(county_cdl) &lt;- cdl_colormap[,c(1,6)]

# coltab(county_cdl) &lt;- cdl_colormap[,1:5]

# plot(county_cdl)
</code></pre>
</div>
</div>
<div id="working-with-vector-points-and-polygons-data"
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Working with vector
(points and polygons) data</h1>
<div id="read-in-point-data" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Read in point
data</h2>
<p>Often we collect and store point data as coordinates in a non-spatial
format such as a csv file which we need to convert into a spatial object
in R.</p>
<p>In the /data directory you should find a csv file with a set of
points from Centre County Pa. We will read in and inspect these
data.</p>
<pre class="r"><code>centre_sites &lt;- read.csv(&quot;data/centre_co_pts.csv&quot;)
centre_sites
#&gt;   SiteID      Long      Lat
#&gt; 1  Site1 -77.70654 40.80497
#&gt; 2  Site2 -77.89991 40.74921
#&gt; 3  Site3 -77.93778 41.00641
#&gt; 4  Site4 -77.86590 40.81954
#&gt; 5  Site5 -77.64715 41.02197
#&gt; 6  Site6 -77.84409 40.87366
#&gt; 7  Site7 -77.77373 40.82634
#&gt; 8  Site8 -77.69934 40.87697</code></pre>
<p>and convert them into an sf spatial object. We use the
<code>coords=</code> argument to indicate the columns that hold the
longitude (X) and latitude (Y). We can also specify the CRS using the
‘crs=’ arguments and the appropriate EPSG code or other crs object. In
our case we will give the EPSG code 4326 which corresponds to WGS 84,
the system commonly used by Google Earth.</p>
<pre class="r"><code>centre_sites &lt;- st_as_sf(centre_sites, 
                         coords=c(&quot;Long&quot;,&quot;Lat&quot;), #indicate the x and y columns
                         crs = 4326) #set the crs</code></pre>
<p>when we inspect the center_sites object we see that there is now
additional information at the top.</p>
<pre class="r"><code>centre_sites
#&gt; Simple feature collection with 8 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -77.93778 ymin: 40.74921 xmax: -77.64715 ymax: 41.02197
#&gt; Geodetic CRS:  WGS 84
#&gt;   SiteID                   geometry
#&gt; 1  Site1 POINT (-77.70654 40.80497)
#&gt; 2  Site2 POINT (-77.89991 40.74921)
#&gt; 3  Site3 POINT (-77.93778 41.00641)
#&gt; 4  Site4  POINT (-77.8659 40.81954)
#&gt; 5  Site5 POINT (-77.64715 41.02197)
#&gt; 6  Site6 POINT (-77.84409 40.87366)
#&gt; 7  Site7 POINT (-77.77373 40.82634)
#&gt; 8  Site8 POINT (-77.69934 40.87697)</code></pre>
</div>
<div id="visualize-point-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Visualize point
data</h2>
<p>Using <code>ggplot2</code> and <code>sf</code> we can add our points
to our earlier map of Centre county with the <code>geom_sf()</code>
function.</p>
<pre class="r"><code>#Centre county CDL from raster exercise
centre_cdl &lt;- rast(&quot;data/centre_county_cdl_2021.tif&quot;) 

ggplot()+
  geom_spatraster(data = centre_cdl, aes(fill = class_name)) +
  geom_sf(data=centre_sites) + 
  theme(legend.title = element_text(size = 7), 
        legend.text = element_text(size = 7), 
        legend.key.size = unit(0.25, &#39;cm&#39;),
        legend.position=&quot;bottom&quot;) </code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="buffer-around-points" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Buffer around
points</h2>
<p>We can create a polygon object from our points by buffering around
them in a 1000m radius. For example, we might do this when assessing
land cover values around a site.</p>
<pre class="r"><code>centre_sites_1000m &lt;- st_buffer(centre_sites, 1000)
centre_sites_1000m
#&gt; Simple feature collection with 8 features and 1 field
#&gt; Geometry type: POLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -77.94977 ymin: 40.74008 xmax: -77.63518 ymax: 41.03112
#&gt; Geodetic CRS:  WGS 84
#&gt;   SiteID                       geometry
#&gt; 1  Site1 POLYGON ((-77.70945 40.8137...
#&gt; 2  Site2 POLYGON ((-77.90568 40.7412...
#&gt; 3  Site3 POLYGON ((-77.92781 41.0013...
#&gt; 4  Site4 POLYGON ((-77.85495 40.8230...
#&gt; 5  Site5 POLYGON ((-77.65648 41.0163...
#&gt; 6  Site6 POLYGON ((-77.84816 40.8651...
#&gt; 7  Site7 POLYGON ((-77.76805 40.8184...
#&gt; 8  Site8 POLYGON ((-77.69978 40.886,...</code></pre>
<p>We can visualize this buffer by adding it to our plot. Note you may
need to expand your plot size to see the buffers behind the points.</p>
<pre class="r"><code>ggplot()+
  geom_spatraster(data = centre_cdl, aes(fill = class_name)) +
  geom_sf(data = centre_sites_1000m)+
  geom_sf(data=centre_sites) + 
  theme(legend.title = element_text(size = 7), 
        legend.text = element_text(size = 7), 
        legend.key.size = unit(0.25, &#39;cm&#39;),
        legend.position=&quot;bottom&quot;) </code></pre>
<p><img src="EcoSpatial_Workshop_GIS_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="extract-cdl-values-within-buffers" class="section level2"
number="2.4">
<h2><span class="header-section-number">2.4</span> Extract CDL values
within buffers</h2>
<p>If we wanted to assess land cover around a site in a way that is
similar to the results that beeshiny provides, we can use the
<code>extract()</code> function from terra. First providing the raster
we want to extract values from, then the sf object that defines the
zones in which the raster will the summarized.</p>
<pre class="r"><code>centre_table_1000m &lt;- terra::extract(centre_cdl, centre_sites_1000m, fun=&quot;table&quot;, ID=F)
centre_table_1000m
#&gt;   Background Corn Cotton Rice Sorghum Soybeans Sunflower Peanuts Tobacco Sweet Corn
#&gt; 1          0 1240      0    0      12     1021         0       0       0          0
#&gt; 2          0 1168      0    0       0      968         0       0       0          0
#&gt; 3          0    0      0    0       0        0         0       0       0          0
#&gt; 4          0   64      0    0       0       80         0       0       0          0
#&gt; 5          0   18      0    0       1        5         0       0       0          0
#&gt; 6          0  882      0    0       1      836         0       0       0          0
#&gt; 7          0    0      0    0       0        0         0       0       0          0
#&gt;   Pop or Orn Corn Mint Barley Durum Wheat Spring Wheat Winter Wheat Other Small Grains
#&gt; 1               0    0      0           0            0          225                  0
#&gt; 2               0    0      7           0            0          445                  0
#&gt; 3               0    0      0           0            0            0                  0
#&gt; 4               0    0      1           0            0            7                  0
#&gt; 5               0    0      0           0            0            1                  0
#&gt; 6               0    0      1           0            0           24                  0
#&gt; 7               0    0      0           0            0            0                  0
#&gt;   Dbl Crop WinWht/Soybeans Rye Oats Millet Speltz Canola Flaxseed Safflower Rape Seed Mustard
#&gt; 1                        0   2   20      0      0      0        0         0         0       0
#&gt; 2                        0   7  136      0      0      0        0         0         0       0
#&gt; 3                        0   0    0      0      0      0        0         0         0       0
#&gt; 4                        0   0    0      0      0      0        0         0         0       0
#&gt; 5                        0   0    0      0      0      0        0         0         0       0
#&gt; 6                        0   0    0      0      0      0        0         0         0       0
#&gt; 7                        0   0    0      0      0      0        0         0         0       0
#&gt;   Alfalfa Other Hay/Non Alfalfa Camelina Buckwheat Sugarbeets Dry Beans Potatoes Other Crops
#&gt; 1     156                    88        0         0          0        43        0           0
#&gt; 2     100                    29        0         0          0       118        0           0
#&gt; 3       0                     0        0         0          0         0        0           0
#&gt; 4      82                   410        0         0          0         0        0           0
#&gt; 5       2                    50        0         0          0         1        0           0
#&gt; 6     124                   407        0         0          0         0        0           0
#&gt; 7       0                     0        0         0          0         0        0           0
#&gt;   Sugarcane Sweet Potatoes Misc Vegs &amp; Fruits Watermelons Onions Cucumbers Chick Peas Lentils
#&gt; 1         0              0                  0           0      0         0          0       0
#&gt; 2         0              0                  0           0      0         0          0       0
#&gt; 3         0              0                  0           0      0         0          0       0
#&gt; 4         0              0                  0           0      0         0          0       0
#&gt; 5         0              0                  0           0      0         0          0       0
#&gt; 6         0              0                  0           0      0         0          0       0
#&gt; 7         0              0                  0           0      0         0          0       0
#&gt;   Peas Tomatoes Caneberries Hops Herbs Clover/Wildflowers Sod/Grass Seed Switchgrass
#&gt; 1    0        0           0    0     0                  0              0           0
#&gt; 2    0        0           0    0     0                  0              0           0
#&gt; 3    0        0           0    0     0                  0              0           0
#&gt; 4    0        1           0    0     0                  0              0           0
#&gt; 5    0        1           0    0     0                  0              0           0
#&gt; 6    0        0           0    0     0                  0              0           0
#&gt; 7    0        0           0    0     0                  0              0           0
#&gt;   Fallow/Idle Cropland Forest Cherries Peaches Apples Grapes Christmas Trees Other Tree Crops
#&gt; 1                    0      0        0       0      0      0               0                0
#&gt; 2                    0      0        0       0      0      0               0                0
#&gt; 3                    0      0        0       0      0      0               0                0
#&gt; 4                    0      0        0       0      1      0               0                0
#&gt; 5                    0      0        0       0      0      0               0                0
#&gt; 6                    0      0        0       0      1      0               0                0
#&gt; 7                    0      0        0       0      0      0               0                0
#&gt;   Citrus Pecans Almonds Walnuts Pears Clouds/No Data Developed Water Wetlands Nonag/Undefined
#&gt; 1      0      0       0       0     0              0         0     0        0               0
#&gt; 2      0      0       0       0     0              0         0     0        0               0
#&gt; 3      0      0       0       0     0              0         0     0        0               0
#&gt; 4      0      0       0       0     0              0         0     0        0               0
#&gt; 5      0      0       0       0     0              0         0     0        0               0
#&gt; 6      0      0       0       0     0              0         0     0        0               0
#&gt; 7      0      0       0       0     0              0         0     0        0               0
#&gt;   Aquaculture Open Water Perennial Ice/Snow Developed/Open Space Developed/Low Intensity
#&gt; 1           0          0                  0                  224                      69
#&gt; 2           0          0                  0                   52                      95
#&gt; 3           0          0                  0                  208                       9
#&gt; 4           0          0                  0                  298                     367
#&gt; 5           0       1621                  0                  172                      95
#&gt; 6           0          0                  0                  299                     214
#&gt; 7           0          0                  0                  135                       1
#&gt;   Developed/Med Intensity Developed/High Intensity Barren Deciduous Forest Evergreen Forest
#&gt; 1                      22                        2      4              178               10
#&gt; 2                      45                        8      0              116                1
#&gt; 3                       2                        0      0             3264                1
#&gt; 4                     401                      137      1              474              106
#&gt; 5                      33                        0      7              391               35
#&gt; 6                      22                        4      1              236                6
#&gt; 7                       0                        0      0             3358                9
#&gt;   Mixed Forest Shrubland Grassland/Pasture Woody Wetlands Herbaceous Wetlands Pistachios
#&gt; 1           22         0               213              0                   0          0
#&gt; 2           12         0               241              0                   0          0
#&gt; 3           56         0                 9              0                   0          0
#&gt; 4          303         1               806              0                   0          0
#&gt; 5          692         1               415              5                   1          0
#&gt; 6           56         1               437              0                   0          0
#&gt; 7           37         5                 4              0                   0          0
#&gt;   Triticale Carrots Asparagus Garlic Cantaloupes Prunes Olives Oranges Honeydew Melons
#&gt; 1         0       0         0      0           0      0      0       0               0
#&gt; 2         2       0         0      0           0      0      0       0               0
#&gt; 3         0       0         0      0           0      0      0       0               0
#&gt; 4         1       0         0      0           0      0      0       0               0
#&gt; 5         1       0         0      0           0      0      0       0               0
#&gt; 6         0       0         0      0           0      0      0       0               0
#&gt; 7         0       0         0      0           0      0      0       0               0
#&gt;   Broccoli Avocados Peppers Pomegranates Nectarines Greens Plums Strawberries Squash Apricots
#&gt; 1        0        0       0            0          0      0     0            0      0        0
#&gt; 2        0        0       0            0          0      0     0            0      0        0
#&gt; 3        0        0       0            0          0      0     0            0      0        0
#&gt; 4        0        0       0            0          0      0     0            0      0        0
#&gt; 5        0        0       0            0          0      0     0            0      0        0
#&gt; 6        0        0       0            0          0      0     0            0      0        0
#&gt; 7        0        0       0            0          0      0     0            0      0        0
#&gt;   Vetch Dbl Crop WinWht/Corn Dbl Crop Oats/Corn Lettuce Dbl Crop Triticale/Corn Pumpkins
#&gt; 1     0                    0                  0       0                       0        0
#&gt; 2     0                    2                  0       0                       0        0
#&gt; 3     0                    0                  0       0                       0        0
#&gt; 4     0                    3                  0       0                       1        1
#&gt; 5     0                    0                  1       0                       0        0
#&gt; 6     0                    0                  0       0                       0        0
#&gt; 7     0                    0                  0       0                       0        0
#&gt;   Dbl Crop Lettuce/Durum Wht Dbl Crop Lettuce/Cantaloupe Dbl Crop Lettuce/Cotton
#&gt; 1                          0                           0                       0
#&gt; 2                          0                           0                       0
#&gt; 3                          0                           0                       0
#&gt; 4                          0                           0                       0
#&gt; 5                          0                           0                       0
#&gt; 6                          0                           0                       0
#&gt; 7                          0                           0                       0
#&gt;   Dbl Crop Lettuce/Barley Dbl Crop Durum Wht/Sorghum Dbl Crop Barley/Sorghum
#&gt; 1                       0                          0                       0
#&gt; 2                       0                          0                       0
#&gt; 3                       0                          0                       0
#&gt; 4                       0                          0                       0
#&gt; 5                       0                          0                       0
#&gt; 6                       0                          0                       0
#&gt; 7                       0                          0                       0
#&gt;   Dbl Crop WinWht/Sorghum Dbl Crop Barley/Corn Dbl Crop WinWht/Cotton
#&gt; 1                       0                    0                      0
#&gt; 2                       0                    0                      0
#&gt; 3                       0                    0                      0
#&gt; 4                       1                    0                      0
#&gt; 5                       0                    0                      0
#&gt; 6                       0                    0                      0
#&gt; 7                       0                    0                      0
#&gt;   Dbl Crop Soybeans/Cotton Dbl Crop Soybeans/Oats Dbl Crop Corn/Soybeans Blueberries Cabbage
#&gt; 1                        0                      0                      0           0       0
#&gt; 2                        0                      0                      0           0       0
#&gt; 3                        0                      0                      0           0       0
#&gt; 4                        0                      0                      0           0       0
#&gt; 5                        0                      0                      0           0       0
#&gt; 6                        0                      0                      0           0       0
#&gt; 7                        0                      0                      0           0       0
#&gt;   Cauliflower Celery Radishes Turnips Eggplants Gourds Cranberries Dbl Crop Barley/Soybeans
#&gt; 1           0      0        0       0         0      0           0                        0
#&gt; 2           0      0        0       0         0      0           0                        0
#&gt; 3           0      0        0       0         0      0           0                        0
#&gt; 4           0      0        0       0         0      0           0                        0
#&gt; 5           0      0        0       0         0      0           0                        0
#&gt; 6           0      0        0       0         0      0           0                        0
#&gt; 7           0      0        0       0         0      0           0                        0
#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1 rows ]</code></pre>
<p>We can calculate additional statistics such as the area within the
buffer for each site.</p>
<pre class="r"><code>Area_m2 &lt;- rowSums(centre_table_1000m)*900</code></pre>
<p>and turn our table into proportional cover of different land
classes.</p>
<pre class="r"><code>centre_table_1000m_prop &lt;- centre_table_1000m/rowSums(centre_table_1000m)

centre_table_1000m_prop &lt;- cbind(Area_m2,centre_table_1000m_prop)
centre_table_1000m_prop
#&gt;   Area_m2 Background        Corn Cotton Rice      Sorghum    Soybeans Sunflower Peanuts
#&gt; 1 3195900          0 0.349197409      0    0 0.0033793298 0.287524641         0       0
#&gt; 2 3196800          0 0.328828829      0    0 0.0000000000 0.272522523         0       0
#&gt; 3 3194100          0 0.000000000      0    0 0.0000000000 0.000000000         0       0
#&gt; 4 3192300          0 0.018043417      0    0 0.0000000000 0.022554271         0       0
#&gt; 5 3194100          0 0.005071851      0    0 0.0002817695 0.001408848         0       0
#&gt; 6 3196800          0 0.248310811      0    0 0.0002815315 0.235360360         0       0
#&gt; 7 3194100          0 0.000000000      0    0 0.0000000000 0.000000000         0       0
#&gt;   Tobacco Sweet Corn Pop or Orn Corn Mint       Barley Durum Wheat Spring Wheat Winter Wheat
#&gt; 1       0          0               0    0 0.0000000000           0            0 0.0633624331
#&gt; 2       0          0               0    0 0.0019707207           0            0 0.1252815315
#&gt; 3       0          0               0    0 0.0000000000           0            0 0.0000000000
#&gt; 4       0          0               0    0 0.0002819284           0            0 0.0019734987
#&gt; 5       0          0               0    0 0.0000000000           0            0 0.0002817695
#&gt; 6       0          0               0    0 0.0002815315           0            0 0.0067567568
#&gt; 7       0          0               0    0 0.0000000000           0            0 0.0000000000
#&gt;   Other Small Grains Dbl Crop WinWht/Soybeans          Rye        Oats Millet Speltz Canola
#&gt; 1                  0                        0 0.0005632216 0.005632216      0      0      0
#&gt; 2                  0                        0 0.0019707207 0.038288288      0      0      0
#&gt; 3                  0                        0 0.0000000000 0.000000000      0      0      0
#&gt; 4                  0                        0 0.0000000000 0.000000000      0      0      0
#&gt; 5                  0                        0 0.0000000000 0.000000000      0      0      0
#&gt; 6                  0                        0 0.0000000000 0.000000000      0      0      0
#&gt; 7                  0                        0 0.0000000000 0.000000000      0      0      0
#&gt;   Flaxseed Safflower Rape Seed Mustard     Alfalfa Other Hay/Non Alfalfa Camelina Buckwheat
#&gt; 1        0         0         0       0 0.043931287           0.024781752        0         0
#&gt; 2        0         0         0       0 0.028153153           0.008164414        0         0
#&gt; 3        0         0         0       0 0.000000000           0.000000000        0         0
#&gt; 4        0         0         0       0 0.023118128           0.115590640        0         0
#&gt; 5        0         0         0       0 0.000563539           0.014088476        0         0
#&gt; 6        0         0         0       0 0.034909910           0.114583333        0         0
#&gt; 7        0         0         0       0 0.000000000           0.000000000        0         0
#&gt;   Sugarbeets    Dry Beans Potatoes Other Crops Sugarcane Sweet Potatoes Misc Vegs &amp; Fruits
#&gt; 1          0 0.0121092650        0           0         0              0                  0
#&gt; 2          0 0.0332207207        0           0         0              0                  0
#&gt; 3          0 0.0000000000        0           0         0              0                  0
#&gt; 4          0 0.0000000000        0           0         0              0                  0
#&gt; 5          0 0.0002817695        0           0         0              0                  0
#&gt; 6          0 0.0000000000        0           0         0              0                  0
#&gt; 7          0 0.0000000000        0           0         0              0                  0
#&gt;   Watermelons Onions Cucumbers Chick Peas Lentils Peas     Tomatoes Caneberries Hops Herbs
#&gt; 1           0      0         0          0       0    0 0.0000000000           0    0     0
#&gt; 2           0      0         0          0       0    0 0.0000000000           0    0     0
#&gt; 3           0      0         0          0       0    0 0.0000000000           0    0     0
#&gt; 4           0      0         0          0       0    0 0.0002819284           0    0     0
#&gt; 5           0      0         0          0       0    0 0.0002817695           0    0     0
#&gt; 6           0      0         0          0       0    0 0.0000000000           0    0     0
#&gt; 7           0      0         0          0       0    0 0.0000000000           0    0     0
#&gt;   Clover/Wildflowers Sod/Grass Seed Switchgrass Fallow/Idle Cropland Forest Cherries Peaches
#&gt; 1                  0              0           0                    0      0        0       0
#&gt; 2                  0              0           0                    0      0        0       0
#&gt; 3                  0              0           0                    0      0        0       0
#&gt; 4                  0              0           0                    0      0        0       0
#&gt; 5                  0              0           0                    0      0        0       0
#&gt; 6                  0              0           0                    0      0        0       0
#&gt; 7                  0              0           0                    0      0        0       0
#&gt;         Apples Grapes Christmas Trees Other Tree Crops Citrus Pecans Almonds Walnuts Pears
#&gt; 1 0.0000000000      0               0                0      0      0       0       0     0
#&gt; 2 0.0000000000      0               0                0      0      0       0       0     0
#&gt; 3 0.0000000000      0               0                0      0      0       0       0     0
#&gt; 4 0.0002819284      0               0                0      0      0       0       0     0
#&gt; 5 0.0000000000      0               0                0      0      0       0       0     0
#&gt; 6 0.0002815315      0               0                0      0      0       0       0     0
#&gt; 7 0.0000000000      0               0                0      0      0       0       0     0
#&gt;   Clouds/No Data Developed Water Wetlands Nonag/Undefined Aquaculture Open Water
#&gt; 1              0         0     0        0               0           0  0.0000000
#&gt; 2              0         0     0        0               0           0  0.0000000
#&gt; 3              0         0     0        0               0           0  0.0000000
#&gt; 4              0         0     0        0               0           0  0.0000000
#&gt; 5              0         0     0        0               0           0  0.4567484
#&gt; 6              0         0     0        0               0           0  0.0000000
#&gt; 7              0         0     0        0               0           0  0.0000000
#&gt;   Perennial Ice/Snow Developed/Open Space Developed/Low Intensity Developed/Med Intensity
#&gt; 1                  0           0.06308082            0.0194311462             0.006195438
#&gt; 2                  0           0.01463964            0.0267454955             0.012668919
#&gt; 3                  0           0.05860806            0.0025359256             0.000563539
#&gt; 4                  0           0.08401466            0.1034677192             0.113053284
#&gt; 5                  0           0.04846436            0.0267681037             0.009298394
#&gt; 6                  0           0.08417793            0.0602477477             0.006193694
#&gt; 7                  0           0.03803888            0.0002817695             0.000000000
#&gt;   Developed/High Intensity       Barren Deciduous Forest Evergreen Forest Mixed Forest
#&gt; 1             0.0005632216 0.0011264433       0.05012672     0.0028161081  0.006195438
#&gt; 2             0.0022522523 0.0000000000       0.03265766     0.0002815315  0.003378378
#&gt; 3             0.0000000000 0.0000000000       0.91969569     0.0002817695  0.015779093
#&gt; 4             0.0386241895 0.0002819284       0.13363406     0.0298844094  0.085424302
#&gt; 5             0.0000000000 0.0019723866       0.11017188     0.0098619329  0.194984503
#&gt; 6             0.0011261261 0.0002815315       0.06644144     0.0016891892  0.015765766
#&gt; 7             0.0000000000 0.0000000000       0.94618202     0.0025359256  0.010425472
#&gt;      Shrubland Grassland/Pasture Woody Wetlands Herbaceous Wetlands Pistachios    Triticale
#&gt; 1 0.0000000000       0.059983103    0.000000000        0.0000000000          0 0.0000000000
#&gt; 2 0.0000000000       0.067849099    0.000000000        0.0000000000          0 0.0005630631
#&gt; 3 0.0000000000       0.002535926    0.000000000        0.0000000000          0 0.0000000000
#&gt; 4 0.0002819284       0.227234282    0.000000000        0.0000000000          0 0.0002819284
#&gt; 5 0.0002817695       0.116934348    0.001408848        0.0002817695          0 0.0002817695
#&gt; 6 0.0002815315       0.123029279    0.000000000        0.0000000000          0 0.0000000000
#&gt; 7 0.0014088476       0.001127078    0.000000000        0.0000000000          0 0.0000000000
#&gt;   Carrots Asparagus Garlic Cantaloupes Prunes Olives Oranges Honeydew Melons Broccoli
#&gt; 1       0         0      0           0      0      0       0               0        0
#&gt; 2       0         0      0           0      0      0       0               0        0
#&gt; 3       0         0      0           0      0      0       0               0        0
#&gt; 4       0         0      0           0      0      0       0               0        0
#&gt; 5       0         0      0           0      0      0       0               0        0
#&gt; 6       0         0      0           0      0      0       0               0        0
#&gt; 7       0         0      0           0      0      0       0               0        0
#&gt;   Avocados Peppers Pomegranates Nectarines Greens Plums Strawberries Squash Apricots Vetch
#&gt; 1        0       0            0          0      0     0            0      0        0     0
#&gt; 2        0       0            0          0      0     0            0      0        0     0
#&gt; 3        0       0            0          0      0     0            0      0        0     0
#&gt; 4        0       0            0          0      0     0            0      0        0     0
#&gt; 5        0       0            0          0      0     0            0      0        0     0
#&gt; 6        0       0            0          0      0     0            0      0        0     0
#&gt; 7        0       0            0          0      0     0            0      0        0     0
#&gt;   Dbl Crop WinWht/Corn Dbl Crop Oats/Corn Lettuce Dbl Crop Triticale/Corn     Pumpkins
#&gt; 1         0.0000000000       0.0000000000       0            0.0000000000 0.0000000000
#&gt; 2         0.0005630631       0.0000000000       0            0.0000000000 0.0000000000
#&gt; 3         0.0000000000       0.0000000000       0            0.0000000000 0.0000000000
#&gt; 4         0.0008457852       0.0000000000       0            0.0002819284 0.0002819284
#&gt; 5         0.0000000000       0.0002817695       0            0.0000000000 0.0000000000
#&gt; 6         0.0000000000       0.0000000000       0            0.0000000000 0.0000000000
#&gt; 7         0.0000000000       0.0000000000       0            0.0000000000 0.0000000000
#&gt;   Dbl Crop Lettuce/Durum Wht Dbl Crop Lettuce/Cantaloupe Dbl Crop Lettuce/Cotton
#&gt; 1                          0                           0                       0
#&gt; 2                          0                           0                       0
#&gt; 3                          0                           0                       0
#&gt; 4                          0                           0                       0
#&gt; 5                          0                           0                       0
#&gt; 6                          0                           0                       0
#&gt; 7                          0                           0                       0
#&gt;   Dbl Crop Lettuce/Barley Dbl Crop Durum Wht/Sorghum Dbl Crop Barley/Sorghum
#&gt; 1                       0                          0                       0
#&gt; 2                       0                          0                       0
#&gt; 3                       0                          0                       0
#&gt; 4                       0                          0                       0
#&gt; 5                       0                          0                       0
#&gt; 6                       0                          0                       0
#&gt; 7                       0                          0                       0
#&gt;   Dbl Crop WinWht/Sorghum Dbl Crop Barley/Corn Dbl Crop WinWht/Cotton
#&gt; 1            0.0000000000                    0                      0
#&gt; 2            0.0000000000                    0                      0
#&gt; 3            0.0000000000                    0                      0
#&gt; 4            0.0002819284                    0                      0
#&gt; 5            0.0000000000                    0                      0
#&gt; 6            0.0000000000                    0                      0
#&gt; 7            0.0000000000                    0                      0
#&gt;   Dbl Crop Soybeans/Cotton Dbl Crop Soybeans/Oats Dbl Crop Corn/Soybeans Blueberries Cabbage
#&gt; 1                        0                      0                      0           0       0
#&gt; 2                        0                      0                      0           0       0
#&gt; 3                        0                      0                      0           0       0
#&gt; 4                        0                      0                      0           0       0
#&gt; 5                        0                      0                      0           0       0
#&gt; 6                        0                      0                      0           0       0
#&gt; 7                        0                      0                      0           0       0
#&gt;   Cauliflower Celery Radishes Turnips Eggplants Gourds Cranberries Dbl Crop Barley/Soybeans
#&gt; 1           0      0        0       0         0      0           0                        0
#&gt; 2           0      0        0       0         0      0           0                        0
#&gt; 3           0      0        0       0         0      0           0                        0
#&gt; 4           0      0        0       0         0      0           0                        0
#&gt; 5           0      0        0       0         0      0           0                        0
#&gt; 6           0      0        0       0         0      0           0                        0
#&gt; 7           0      0        0       0         0      0           0                        0
#&gt;  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1 rows ]</code></pre>
</div>
<div id="write-out-shapefiles" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Write out
shapefiles</h2>
<p>we can write out vector data to shapefiles using
<code>st_write()</code></p>
<pre class="r"><code>st_write(centre_sites, &quot;data/centre_sites.shp&quot;, delete_layer = TRUE)
#&gt; Deleting layer `centre_sites&#39; using driver `ESRI Shapefile&#39;
#&gt; Writing layer `centre_sites&#39; to data source `data/centre_sites.shp&#39; using driver `ESRI Shapefile&#39;
#&gt; Writing 8 features with 1 fields and geometry type Point.
st_write(centre_sites_1000m, &quot;data/centre_sites_buffer_1000m.shp&quot;, delete_layer = TRUE)
#&gt; Deleting layer `centre_sites_buffer_1000m&#39; using driver `ESRI Shapefile&#39;
#&gt; Writing layer `centre_sites_buffer_1000m&#39; to data source 
#&gt;   `data/centre_sites_buffer_1000m.shp&#39; using driver `ESRI Shapefile&#39;
#&gt; Writing 8 features with 1 fields and geometry type Polygon.</code></pre>
</div>
<div id="check-your-learning-1" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Check your
learning</h2>
<ol style="list-style-type: decimal">
<li><p>Using beeshiny, extract the CDL values for 1km around the centre
county points for the same year of the CDL that you used in the last
activity.</p></li>
<li><p>Compare the CDL values from beeshiny for the centre county sites
to the values you produced using the extract function above. Values
should be similar but not exacly the same because beeshiny uses
exactextractr (<code>?exact_extract</code>) instead of the
<code>terra::extract</code> function.</p></li>
</ol>
</div>
<div id="feedback-on-usability-and-data-availability"
class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Feedback on usability
and data availability</h2>
<p>If you’re interested in beeshiny, please give us your <a
href="https://forms.office.com/r/Zfjf8wvznD"><strong>feedback on
usability</strong></a> and <a
href="https://forms.office.com/r/CnpgRcRwq9"><strong>data
availability</strong></a>!</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
